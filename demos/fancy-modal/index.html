<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" crossorigin href="./assets/index-DF6Eenbv.css">
</head>
<body>

<dialog>
    <h2>Default Monochrome</h2>
        
    <p>Every setting deserves a default. This one deserves grey.</p>

    <button>How drab</button>
</dialog>

<dialog class="red">
    <h2>&times; An error occurred or something.</h2>
        
    <p>Either that or you're about to do something <strong>permanent</strong>.</p>

    <button>I accept the risk</button>
</dialog>

<dialog class="green">
    <h2>&check; Success!</h2>

    <p>The transaction went through, you will be contacted shortly.</p>

    <p>Your reference number is: <code><script>document.write(Math.floor(Math.random() * 100000000000).toString(36))</script></code></p>

    <button>Sick bruv</button>
</dialog>

<dialog class="blurple">
    <h2>Blurple</h2>

    <p>I feel like this combo would have a pleasant smell?</p>

    <button>Lavender probably</button>
</dialog>

<dialog class="sunset">
    <h2>Sunset</h2>

    <p>Warm echoes of summer channel the serenity of an ocean breeze</p>

    <button>What?</button>
</dialog>

<main>
    <h1>Fancy Modal</h1>

    <p>
        Some examples of animating the <code>&lt;dialog&gt;</code> element, as an
        attempt to recreate a <a href="https://examples.motion.dev/react/warp-overlay">cool
        animation I saw on reddit</a>. I think its turned out pretty well, the animation is
        all CSS with a bit of JS to handle the events. I've done a few colour variants,
        you could actually go much further with customising these - have them come
        in from different angles and such.
    </p>

    <p>
        I've <a href="https://github.com/simon-raynor/fancy-modal">put the code for this demo
        on Github</a>, and you are welcome to use it. I would suggest that it's best suited
        as inspiration for your own custom modals, rather than production-ready code itself.
    </p>

    <div class="buttonwrap"></div>

    <label>
        <input name="slow" type="checkbox" />
        <span>Slow it down so I can see</span>
    </label>
</main>

<script>
const dialogs = document.querySelectorAll('dialog');
const buttonwrap = document.querySelector('.buttonwrap');

const show = dialog => {
    dialog.showModal();
}

dialogs.forEach(dialog => {
    const btn = document.createElement('button');

    btn.addEventListener('click', _ => dialog.showModal());
    btn.textContent = dialog.className || 'default';

    bindOut(dialog);

    buttonwrap.append(btn);
});


function bindOut(dialog) {
    dialog.querySelector('button').addEventListener('click', evt => {
        dialog.classList.add('out');
    });


    let animstartTimeout = setTimeout(() => dialog.close(), 100);
    
    dialog.addEventListener('animationstart', evt => {console.log('clearing timeout s')
        const ac = new AbortController();

        clearTimeout(animstartTimeout);

        const animendTimeout = setTimeout(() => {ac.abort(); dialog.close();}, 5000);

        dialog.addEventListener('animationend', evt => {
            clearTimeout(animendTimeout);
            ac.abort();

            if (dialog.classList.contains('out')) {console.log('clearing timeout e')
                dialog.close();
                requestAnimationFrame(() => dialog.classList.remove('out'));
            }
        }, { signal: ac.signal });
    });
}

const initialDuration = window.getComputedStyle(document.body).getPropertyValue('--duration');
const slowtoggle = document.querySelector('input[type="checkbox"]');
slowtoggle.addEventListener('change', evt => {
    document.body.style.setProperty('--duration', evt.target.checked ? `${Number(initialDuration.replace('s', '')) * 5}s` : initialDuration)
})
slowtoggle.checked = false;

</script>

</body>
</html>