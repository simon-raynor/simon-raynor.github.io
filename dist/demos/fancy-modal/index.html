<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" crossorigin href="/assets/index-efB-rIcD.css">
</head>
<body>

<dialog>
    <h2>Default Monochrome</h2>
        
    <p>Because the settings need a default.</p>

    <button>How drab</button>
</dialog>

<dialog class="red">
    <h2>An error occurred or something.</h2>
        
    <p>Either that or you're about to do something <strong>permanent</strong>.</p>

    <button>I accept the risk</button>
</dialog>

<dialog class="green">
    <h2>Success!</h2>

    <p>The transaction went through, you will be contacted shortly.</p>

    <p>Your reference number is: <code><script>document.write(Math.floor(Math.random() * 100000000000).toString(36))</script></code></p>

    <button>Sick bruv</button>
</dialog>

<dialog class="blurple">
    <h2>Blurple</h2>

    <p>I feel like this combo would smell nice?</p>

    <button>Lavender probably</button>
</dialog>

<dialog class="sunset">
    <h2>Sunset</h2>

    <p>Warm echoes of summer</p>

    <button>What?</button>
</dialog>

<main>
    <h1>Fancy Modal</h1>

    <p>
        I saw a cool modal open animation on reddit. I since went down multiple
        rabbit holes involving the <code>&lt;dialog&gt;</code> element, not even
        related to the swanky effect I was trying to recreate. Got there in the
        end though, and I think its turned out pretty well. It should also be
        super-duper a11y friendly because it uses the aforementioned <code>&lt;dialog&gt;</code>.
        It's all CSS with a teensy bit of JavaScript to handle the events. As a
        proof-of-concept I'm quite happy with it.
    </p>

    <p>
        Click the buttons below to see the effect. I've done a few colour variants,
        you could actually go much further with customising these - have them come
        in from different angles and such. It's actually so simple once I got my head
        around it that I'll likely be using parts of this in every modal I do from
        now on. <a href="https://github.com/simon-raynor/fancy-modal">Code for it is on Github</a>.
    </p>

    <div class="buttonwrap"></div>

    <label>
        <input name="slow" type="checkbox" />
        <span>Slow it down so I can see</span>
    </label>
</main>

<script>
const dialogs = document.querySelectorAll('dialog');
const buttonwrap = document.querySelector('.buttonwrap');

const show = dialog => {
    dialog.showModal();
}

dialogs.forEach(dialog => {
    const btn = document.createElement('button');

    btn.addEventListener('click', _ => dialog.showModal());
    btn.textContent = dialog.className || 'default';

    bindOut(dialog);

    buttonwrap.append(btn);
});


function bindOut(dialog) {
    dialog.querySelector('button').addEventListener('click', evt => {
        dialog.classList.add('out');
    });
    // TODO: what if this doesn't fire? Might need a timeout fallback call to dialog.close()?
    dialog.addEventListener('animationend', evt => {
        if (dialog.classList.contains('out')) {
            dialog.close();
            dialog.classList.remove('out');
        }
    });
}

const initialDuration = window.getComputedStyle(document.body).getPropertyValue('--duration');
const slowtoggle = document.querySelector('input[type="checkbox"]');
slowtoggle.addEventListener('change', evt => {
    document.body.style.setProperty('--duration', evt.target.checked ? `${Number(initialDuration.replace('s', '')) * 5}s` : initialDuration)
})
console.log(initialDuration)

</script>

</body>
</html>